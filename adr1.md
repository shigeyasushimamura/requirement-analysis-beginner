# ADR-001: 大規模トラフィックとデータ増大に対応するストレージ戦略

- **Status:** Accepted
- **Date:** 2025-12-24

# Context

- 5 年間で 146TB に達するデータ量と、ピーク時 8700QPS の書き込みを捌く必要がある。
- 単一の RDB インスタンスではストレージ容量、I/O パフォーマンス、バックアップ運用の面で限界がある
- 配送完了後の古いデータは参照頻度が下がるが、ビジネス分析(OLAP)のために保持が必要である

# Decision

- RDB シャーディング: `ShipmentID`をシャードキーとした水平分散を採用する
- ハイブリッドパーティショニング: 各シャード内で月単位のレンジパーティションを作成する
- データ階層化: 直近の「Hot Data」は高性能ストレージに配置し、3 か月以上経過した「Cold Data」は S3 などのオブジェクトストレージへアーカイブ、または Big Query などの分析基盤へ ETL 送信する

# Consequence

- Positive: 書き込み負荷を分散でき、データ量が増大しても水平スケーリングで対応可能。古いデータのパージが容易
- Negative: シャードを跨るクエリが困難になるので、アプリケーション側での結合や集計の工夫が必要になる
